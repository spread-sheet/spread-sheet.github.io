customElements.define("spread-sheet",class extends HTMLElement{Element({tag:e,Elements:t=[],...l},o=Object.assign(document.createElement(e),l)){return o.append(...t),o}connectedCallback(e=(this.getAttribute("rows")||"123").split``,t=(this.getAttribute("columns")||"ABC").split``,l=this){this.cells=e.map(((e,l)=>t.map(((t,o)=>({col:t,row:e,colidx:o,rowidx:l,name:String(t)+String(e)}))))).flat().map((({col:o,row:i,rowidx:n,colidx:a,name:s})=>(l[s]=new Proxy(this.Element({tag:"input",id:s,value:s,part:`cell ${s} col${a+1} row${n+1}`,parts:new Set(["cell",s,`col${a+1}`,`row${n+1}`]),col:o,row:i,colidx:a,rowidx:n,formula:!1,onkeyup:o=>{if(console.log(o.key,o.keyCode),"Enter"==o.key)this.calc();else if(o.keyCode>36&&o.keyCode<41){let i=a,s=n;37==o.keyCode&&i>0?--i:38==o.keyCode&&s>0?--s:39==o.keyCode&&i<t.length?++i:40==o.keyCode&&s<e.length&&++s,l.go(String(t[i])+String(e[s]))}else console.warn("key",o.key,o.keyCode)}}),{get:(e,t)=>"function"==typeof l[t]?e[t].bind(e):t in e?e[t]:e,set:(e,t,o)=>"part"==t?("-"==o[0]?e.parts.delete(o=o.slice(1)):e.parts.add(o),e.part=Array.from(e.parts).join(" "),e):("="==o[0]?e.formula=o:e.formula=!1,t in e?(e[t]=o,l.calc(),o):void 0),defineProperty:(e,t,l)=>(l&&"value"in l&&e.setItem(t,l.value),e)}),l[s].input))),this.attachShadow({mode:"open"}).append(this.Element({tag:"style",innerText:`div{display:grid;grid:${"repeat("+e.length+",1fr)"}/${"repeat("+t.length+",1fr)"};gap:0;margin:0;padding:0}input{width:calc(100% - 5px)}`}),this.Element({tag:"div",Elements:this.cells})),this.go("C1")}calc(){this.cells.map((node=>{node.formula&&(node.value=eval(node.formula.split(/\s*(<?->|[-&|()]|\w+)\s*/).filter(Boolean).slice(1).map((e=>this[e]?this[e].value:e)).join``))}))}go(e){this[e].focus()}});