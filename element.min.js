customElements.define("spread-sheet",class extends HTMLElement{Element({tag:e,Elements:t=[],...l},a=Object.assign(document.createElement(e),l)){return a.append(...t),a}connectedCallback(e=this,t=(e.getAttribute("rows")||"123").split``,l=(e.getAttribute("columns")||"ABC").split``){e.connected=!1,e.formula=!0,e.cells=t.map(((e,t)=>l.map(((l,a)=>({col:l,row:e,colidx:a,rowidx:t,name:String(l)+String(e)}))))).flat().map((({col:a,row:o,rowidx:r,colidx:n,name:i})=>(e[i]=new Proxy(e.Element({tag:"input",id:i,value:0,part:`cell ${i} col${n+1} row${r+1}`,parts:new Set(["cell",i,`col${n+1}`,`row${r+1}`]),setparts:t=>{let l=e[i].input;"-"==t[0]?l.parts.delete(t=t.slice(1)):l.parts.add(t),l.part=Array.from(l.parts).join(" ")},col:a,row:o,colidx:n,rowidx:r,formula:i,onkeyup:a=>{if(13==a.keyCode)e[i].value=a.target.value,e.formula=!1,e.calc();else if(113==a.keyCode)this.toggle(this);else if(a.keyCode>36&&a.keyCode<41){let o=n,i=r;37==a.keyCode&&o>0?--o:38==a.keyCode&&i>0?--i:39==a.keyCode&&o<l.length?++o:40==a.keyCode&&i<t.length&&++i,e.go(String(l[o])+String(t[i]))}}}),{get:(t,l)=>"function"==typeof e[l]?t[l].bind(t):l in t?t[l]:t,set(t,l,a){try{if("part"==l)return e[i].setparts(a),t;if("="==a[0]&&(t.formula=a),l in t)return t[l]=a,e.calc(),a}catch(e){}},defineProperty:(e,t,l)=>(l&&"value"in l&&e.setItem(t,l.value),e)}),e[i].input))),e.attachShadow({mode:"open"}).append(e.Element({tag:"style",innerText:`div{display:grid;grid:${"repeat("+t.length+",1fr)"}/${"repeat("+l.length+",1fr)"};gap:0;margin:0;padding:0}input{width:calc(100% - 5px)}`}),e.Element({tag:"div",Elements:e.cells})),e.connected=!0,e.A1.value=22,e.B1.value=10,e.A2.value=20,e.C1.value="=A1+B1",e.A3.value="=A1*A2",e.A1.part="foo",e.A1.part="-foo",e.C2.value="=C1",e.A1.value=22,e.A2.value=10,e.A3.value="=(A1*A2+20)*.9",e.A1.part="foo",e.A1.part="-foo",e.go("A3"),e.toggle(e)}toggle(e=this){e.toggleAttribute("formula",!(e.formula=!e.formula)),this.cells.map((t=>{t.value=t.formula==t.id?t.value:e.formula?this[t.id].value=t.formula:t.formula||t.value,this.calc()}))}calc(sheet=this){this.connected&&sheet.cells.map((node=>{if(node.id==node.formula?(node.setparts("-formula"),node.parts.delete("formula")):(node.setparts("formula"),node.parts.add("formula")),node.part=Array.from(node.parts).join(" "),sheet.formula){let value=eval(node.formula.split(/\s*(<?->|[-&|()]|\w+)\s*/).filter(Boolean).slice("="==node.formula[0]?1:0).map(((e,t,l)=>{if(node.id==node.formula)return node.value;try{return sheet[e]?sheet[e].input.value:e}catch(e){}})).join``);node.formula&&(node.value=value)}}))}go(e){this[e].focus()}});