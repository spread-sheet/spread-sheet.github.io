customElements.define("spread-sheet",class extends HTMLElement{Element({tag:e,Elements:t=[],...l},o=Object.assign(document.createElement(e),l)){return o.append(...t),o}connectedCallback(e=this,t=(e.getAttribute("rows")||"123").split``,l=(e.getAttribute("columns")||"ABC").split``){e.mode=1,e.cells=t.map(((e,t)=>l.map(((l,o)=>({col:l,row:e,colidx:o,rowidx:t,name:String(l)+String(e)}))))).flat().map((({col:o,row:a,rowidx:n,colidx:d,name:r})=>(e[r]=new Proxy(e.Element({tag:"input",id:r,value:0,part:`cell ${r} col${d+1} row${n+1}`,parts:new Set(["cell",r,`col${d+1}`,`row${n+1}`]),cellpart:t=>{let l=e[r].input;"-"==t[0]?l.parts.delete(t=t.slice(1)):l.parts.add(t),l.part=Array.from(l.parts).join(" ")},col:o,row:a,colidx:d,rowidx:n,formula:r,onkeyup:o=>{if(13==o.keyCode)e[r].value=o.target.value,e.mode=1,e.calc();else if(113==o.keyCode)this.toggle(this);else if(e.mode&&o.keyCode>36&&o.keyCode<41){let a=d,r=n;37==o.keyCode&&a>0?--a:38==o.keyCode&&r>0?--r:39==o.keyCode&&a<l.length?++a:40==o.keyCode&&r<t.length&&++r,e.go(String(l[a])+String(t[r]))}}}),{get:(t,l)=>"function"==typeof e[l]?t[l].bind(t):l in t?t[l]:t,set(t,l,o){if("="==o[0]&&(t.formula=o),l in t)return t[l]=o,e.calc(),o},defineProperty:(e,t,l)=>(l&&"value"in l&&e.setItem(t,l.value),e)}),e[r].input))),e.attachShadow({mode:"open"}).append(e.Element({tag:"style",innerHTML:`div{display:grid;grid:${"repeat("+t.length+",1fr)"}/${"repeat("+l.length+",1fr)"};gap:0;margin:0;padding:0}input{width:calc(100% - 5px)}`}),e.Element({tag:"div",Elements:e.cells}))}toggle(e=this){e.toggleAttribute("formula",!(e.mode=!e.mode)),e.cells.map((t=>{t.value=t.formula==t.id?t.value:e.mode?e[t.id].value=t.formula:t.formula||t.value,e.calc()}))}calc(sheet=this){sheet.cells.map((node=>{node.cellpart(sheet.mode||node.id==node.formula?"-formula":"formula"),sheet.mode&&node.formula&&(node.value=eval(node.formula.split(/\s*(<?->|[-&|()]|\w+)\s*/).filter(Boolean).map((e=>e.replace("=",""))).map((e=>node.id==node.formula?node.value:sheet[e]?sheet[e].input.value:e)).join``))}))}go(e){this[e]?.focus()}});