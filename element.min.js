customElements.define("spread-sheet",class extends HTMLElement{Element({tag:e,t:t=[],...n},o=Object.assign(document.createElement(e),n)){return o.append(...t),o}o(e=this,t=(e.getAttribute("rows")||"123").split``,n=(e.getAttribute("columns")||"ABC").split``){e.mode=1,e.cells=t.map(((e,t)=>n.map(((n,o)=>({l:n,i:e,cx:o,rx:t,name:String(n)+String(e)}))))).flat().map((({l:o,i:r,rx:l,cx:i,name:s})=>(e[s]=new Proxy(e.Element({tag:"input",id:s,value:0,part:`cell ${s} col${i+1} row${l+1}`,g:new Set(["cell",s,`col${i+1}`,`row${l+1}`]),m:t=>{let n=e[s].input;"-"==t[0]?n.g.delete(t=t.slice(1)):n.g.add(t),n.part=Array.from(n.g).join(" ")},l:o,i:r,cx:i,rx:l,p:s,onkeyup:o=>{if(13==o.keyCode)e[s].value=o.target.value,e.mode=1,e.u();else if(113==o.keyCode)this.toggle(this);else if(e.mode&&o.keyCode>36&&o.keyCode<41){let r=i,s=l;37==o.keyCode&&r>0?--r:38==o.keyCode&&s>0?--s:39==o.keyCode&&r<n.length?++r:40==o.keyCode&&s<t.length&&++s,e.go(String(n[r])+String(t[s]))}}}),{get:(t,n)=>"function"==typeof e[n]?t[n].bind(t):n in t?t[n]:t,set(t,n,o){if("="==o[0]&&(t.p=o),n in t)return t[n]=o,e.u(),o},defineProperty:(e,t,n)=>(n&&"value"in n&&e.setItem(t,n.value),e)}),e[s].input))),e.attachShadow({mode:"open"}).append(e.Element({tag:"style",innerHTML:`div{display:grid;grid:${"repeat("+t.length+",1fr)"}/${"repeat("+n.length+",1fr)"};gap:0;margin:0;padding:0}input{width:calc(100% - 5px)}`}),e.Element({tag:"div",t:e.cells}))}toggle(e=this){e.toggleAttribute("formula",!(e.mode=!e.mode)),e.cells.map((t=>{t.value=t.p==t.id?t.value:e.mode?e[t.id].value=t.p:t.p||t.value,e.u()}))}u(sheet=this){sheet.cells.map((node=>{node.m(sheet.mode||node.id==node.p?"-formula":"formula"),sheet.mode&&node.p&&(node.value=eval(node.p.split(/\s*(<?->|[-&|()]|\w+)\s*/).filter(Boolean).map((e=>e.replace("=",""))).map((e=>node.id==node.p?node.value:sheet[e]?sheet[e].input.value:e)).join``))}))}go(e){this[e]?.focus()}});