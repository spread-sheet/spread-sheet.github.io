customElements.define("spread-sheet",class extends HTMLElement{Element({tag:e,Elements:t=[],...l},a=Object.assign(document.createElement(e),l)){return a.append(...t),a}connectedCallback(e=this,t=(e.getAttribute("rows")||"123").split``,l=(e.getAttribute("columns")||"ABC").split``){e.mode=1,e.cells=t.map(((e,t)=>l.map(((l,a)=>({col:l,row:e,cx:a,rx:t,name:String(l)+String(e)}))))).flat().map((({col:a,row:o,rx:n,cx:r,name:d})=>(e[d]=new Proxy(e.Element({tag:"input",id:d,value:0,part:`cell ${d} col${r+1} row${n+1}`,parts:new Set(["cell",d,`col${r+1}`,`row${n+1}`]),cellpart:t=>{let l=e[d].input;"-"==t[0]?l.parts.delete(t=t.slice(1)):l.parts.add(t),l.part=Array.from(l.parts).join(" ")},col:a,row:o,cx:r,rx:n,formula:d,onkeyup:a=>{if(13==a.keyCode)e[d].value=a.target.value,e.mode=1,e.calc();else if(113==a.keyCode)this.toggle(this);else if(e.mode&&a.keyCode>36&&a.keyCode<41){let o=r,d=n;37==a.keyCode&&o>0?--o:38==a.keyCode&&d>0?--d:39==a.keyCode&&o<l.length?++o:40==a.keyCode&&d<t.length&&++d,e.go(String(l[o])+String(t[d]))}}}),{get:(t,l)=>"function"==typeof e[l]?t[l].bind(t):l in t?t[l]:t,set(t,l,a){if("="==a[0]&&(t.formula=a),l in t)return t[l]=a,e.calc(),a},defineProperty:(e,t,l)=>(l&&"value"in l&&e.setItem(t,l.value),e)}),e[d].input))),e.attachShadow({mode:"open"}).append(e.Element({tag:"style",innerHTML:`div{display:grid;grid:${"repeat("+t.length+",1fr)"}/${"repeat("+l.length+",1fr)"};gap:0;margin:0;padding:0}input{width:calc(100% - 5px)}`}),e.Element({tag:"div",Elements:e.cells}))}toggle(e=this){e.toggleAttribute("formula",!(e.mode=!e.mode)),e.cells.map((t=>{t.value=t.formula==t.id?t.value:e.mode?e[t.id].value=t.formula:t.formula||t.value,e.calc()}))}calc(sheet=this){sheet.cells.map((node=>{node.cellpart(sheet.mode||node.id==node.formula?"-formula":"formula"),sheet.mode&&node.formula&&(node.value=eval(node.formula.split(/\s*(<?->|[-&|()]|\w+)\s*/).filter(Boolean).map((e=>e.replace("=",""))).map((e=>node.id==node.formula?node.value:sheet[e]?sheet[e].input.value:e)).join``))}))}go(e){this[e]?.focus()}});